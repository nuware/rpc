"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=(r=0,()=>++r);var r;const t="RPC:MethodError";exports.CalleeErrorType="RPC:CalleeError",exports.CallerErrorType="RPC:CallerError",exports.MethodErrorType=t,exports.VERSION="0.0.2",exports.createCallee=()=>{const e=new Map;return{define:(r,t)=>{if("function"!=typeof t)throw new Error('Argument "handler" required and should be a function');e.set(r,t)},receive:async(r={},o)=>{const{id:a=null,method:n,params:s}=r;try{if(!(({method:e,error:r,result:t})=>void 0!==e&&void 0===r&&void 0===t)(r))throw{message:"Invalid Request",type:"RPC:CalleeError"};if(!e.has(n))throw{message:"Method not found",type:"RPC:CalleeError"};const t=e.get(n),i=await(async(e,{method:r,params:t,id:o},a)=>{try{return await Promise.resolve(e(t,a))}catch(e){const a=`An unexpected error occurred while executing "${r}" RPC method:`;throw console.warn(a,{id:o,params:t,error:e}),e}})(t,{method:n,params:s,id:a},o);return a?{id:a,result:i,error:null}:null}catch(e){const{message:r="Unexpected error",type:o=t}=e,n={message:r,type:o};return a?{id:a,error:n,result:null}:null}}}},exports.createCaller=({send:r,createId:t=e}={})=>{if("function"!=typeof r)throw new Error('Property "send" required and should be a function');if("function"!=typeof t)throw new Error('Property "createId" required and should be a function');const o=new Map,a=e=>{const r=o.get(e.id);r&&(o.delete(e.id),r(e))};return{invoke:async({method:e,params:a},n)=>{try{const s=t(),i=await(async({method:e,params:t,id:a=null},n)=>{const s=new Promise((e=>{a&&o.set(a,e)}));return r({method:e,params:t,id:a},n),await s})({method:e,params:a,id:s},n);if(!(({error:e,result:r,method:t})=>void 0===t&&void 0!==e&&void 0!==r)(i))throw{message:"Invalid response format",type:"RPC:CallerError"};if(i.error)throw i.error;return i.result}catch(e){throw e}},notify:async({method:e,params:t},o)=>{try{r({method:e,params:t,id:null},o)}catch(e){}},receive:a,cleanup:()=>{for(const e of o.keys()){a({error:{message:"Pending request is aborted",type:"RPC:CallerError"},result:null,id:e})}},send:r}},exports.createRPC=({callee:e,caller:r})=>({define:e.define,receive:async(t,o={})=>{if(isResponse(t))return r.receive(t);if(isRequest(t)){const a=await e.receive(t,o.callee);if(a)return r.send(a,o.caller)}throw{message:"Received an invalid RPC message",type:"RPC:CallerError"}},invoke:r.invoke,notify:r.notify,callee:e,caller:r});
//# sourceMappingURL=rpc.cjs.js.map
